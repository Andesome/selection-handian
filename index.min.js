!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).momentAgo=t()}(this,function(){"use strict";function o(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach(function(e){s(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r={MAX_TIME_OUT:3500,container:document.body,el:document.body,popup:null,onEnd:function(){},offsetX:2,offsetY:12},e=function(){function n(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),s(this,"trimText",function(e){e=String(e).trim().replace(/([。，！～【】\(\)（）])|(\d)|(\s*)/gi,"").replace(/[a-zA-Z]/g,"");return/[^\u0000-\u00FF]/.test(e)?e:""}),s(this,"getPopup",function(){return e.popup}),s(this,"getPopupVisible",function(){return"none"!==window.getComputedStyle(e.popup).display}),s(this,"getLoadingVisible",function(){var e=document.querySelector("#handian-loading");return e&&0<e.clientHeight}),s(this,"showButton",function(){e.button&&(e.button.style.display="block")}),s(this,"hideButton",function(){e.button&&(e.button.style.display="none")}),s(this,"showPopup",function(){e.popup&&(e.popup.style.display="block")}),s(this,"hidePopup",function(){e.popup&&(e.popup.style.display="none")}),s(this,"hideAll",function(){e.hideButton(),e.hidePopup()}),this.options=i(i({},r),t),this._init(),this._createPopup()}var e,t,o;return e=n,(t=[{key:"_init",value:function(){var n=this,e=this.options;e.container;var t=e.el,o=e.onEnd;window.removeEventListener("mousedown",this.hideAll),t.addEventListener("mouseup",function(e){var t=window.getSelection();"Range"===t.type&&(t=t.toString(),(t=n.trimText(t))&&(n._createButton(event,t),o(e,t,n),window.addEventListener("mousedown",n.hideAll)))})}},{key:"_createButton",value:function(e,t){var n=this,o=document.querySelector(".ly-selection-popup-button");o&&document.body.removeChild(o);var o=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,i=e.clientX,l=e.clientY+o,o=document.createElement("div");return o.setAttribute("class","ly-selection-popup-button"),o.style.position="absolute",o.style.display="block",o.style.left=0,o.style.top=0,o.style.width="32px",o.style.minHeight="32px",o.style.borderRadius="3px",o.style.backgroundColor="#f5f5f5",o.style.fontWeigh=500,o.style.color="#9d6a51",o.style.cursor="pointer",o.style.zIndex="1200",o.style.textAlign="center",o.style.lineHeight="32px",o.innerText="典",o.title="查汉典",o.style.left="".concat(i,"px"),o.style.top="".concat(l+this.options.offsetY,"px"),o.addEventListener("mousedown",function(e){return e.stopPropagation()}),o.addEventListener("click",function(e){e.stopPropagation(),n.hideButton();e=n._createHanDian(t);n.popup.appendChild(e),n.popup.style.left="".concat(i,"px"),n.popup.style.top="".concat(l,"px"),n.showPopup();e=n.calcPosition({x:i+n.options.offsetX,y:l+n.options.offsetY},n.popup);n.callPosition(n.popup,e)}),document.body.appendChild(o),this.button=o}},{key:"_createPopup",value:function(){var e=document.createElement("div");e.setAttribute("class","ly-selection-popup-cotainer"),e.style.position="absolute",e.style.display="none",e.style.zIndex="1201",e.style.left=0,e.style.top=0,e.style.minWidth="375px",e.style.minHeight="375px",e.style.backgroundColor="#fff",e.style.borderRadius="2px",e.style.boxShadow="rgb(0 0 0 / 8%) 1px 2px 13px 0px",e.style.overflow="hidden";var t=document.createElement("p");return t.style.textAlign="center",t.style.fontSize="12px",t.style.height="20px",t.style.lineHeight="20px",t.style.margin="0",t.style.color="#888",t.style.overflow="hidden",t.innerHTML="加載結果中，請稍候……",t.id="handian-loading",e.appendChild(t),document.body.appendChild(e),this.popup=e}},{key:"_createHanDian",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=document.getElementById("handian_content");n&&this.popup.removeChild(n),clearTimeout(this._timer);n=document.createElement("iframe");return n.frameBorder="0",n.src="https://www.zdic.net/hans/".concat(t),n.sandbox="allow-same-origin allow-scripts allow-forms",n.seamless="seamless",n.id="handian_content",n.width="375",n.height="400",console.log("加载汉典",Date.now()),this.showLoading(),n.addEventListener("load",function(){console.log("汉典加载好了",Date.now()),e.hideLoading()}),this.options.MAX_TIME_OUT&&(this._timer=setTimeout(function(){e.getLoadingVisible()&&(console.warn("汉典加载超过".concat(e.options.MAX_TIME_OUT,"ms")),e.hideLoading())},this.options.MAX_TIME_OUT)),n}},{key:"calcPosition",value:function(e,t){if(e&&t){var n=e.x,o=e.y,i=Math.max(window.innerWidth,document.body.scrollWidth),e=Math.max(window.innerHeight,document.body.scrollHeight),t=t.getBoundingClientRect();return{left:Math.min(n,i-t.width),top:Math.min(o,e-t.height)}}}},{key:"callPosition",value:function(e,t){t&&e&&(e.style.transition="all 0.25s cubic-bezier(0, 0, 0.2, 1) 0s",e.style.left="".concat(t.left,"px"),e.style.top="".concat(t.top,"px"))}},{key:"showLoading",value:function(){var e=document.getElementById("handian-loading");e&&(e.style.height="20px")}},{key:"hideLoading",value:function(){var e=document.getElementById("handian-loading");e&&(e.style.height="0")}}])&&l(e.prototype,t),o&&l(e,o),n}();return new e({onEnd:function(e,t,n){Array.isArray(dataLayer)&&dataLayer.push(Object.assign({event:"dianClick",selection_text:t}))}}),e});
